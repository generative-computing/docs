---
title: Watsonx
sidebar_label: Watsonx
---

# Module: `watsonx`

A generic WatsonX.ai compatible backend that wraps around the watson_machine_learning library.

## Classes

### `class WatsonxAIBackend`

A generic backend class for watsonx SDK.

#### Methods

##### `__init__(self, model_id, formatter, base_url, model_options, **kwargs)`

A generic watsonx backend that wraps around the ibm_watsonx_ai sdk.

Args:
model_id  : Model id. Defaults to model_ids.IBM_GRANITE_3_3_8B.
formatter : input formatter. Defaults to TemplateFormatter in __init__.
base_url  : url for watson ML deployment. Defaults to env(WATSONX_URL).
model_options : Global model options to pass to the model. Defaults to None.
api_key : watsonx API key. Defaults to None.
project_id : watsonx project ID. Defaults to None.

-----

##### `_get_watsonx_model_id(self)`

Gets the watsonx model id from the model_id that was provided in the constructor. Raises AssertionError if the ModelIdentifier does not provide a watsonx_name.

-----

##### `filter_chat_completions_kwargs(self, model_options)`

Filter kwargs to only include valid watsonx chat.completions.create parameters.

-----

##### `_simplify_and_merge(self, model_options, is_chat_context)`

Simplifies model_options to use the Mellea specific ModelOption.Option and merges the backend's model_options with those passed into this call.

Rules:
- Within a model_options dict, existing keys take precedence. This means remapping to mellea specific keys will maintain the value of the mellea specific key if one already exists.
- When merging, the keys/values from the dictionary passed into this function take precedence.

Because this function simplifies and then merges, non-Mellea keys from the passed in model_options will replace
Mellea specific keys from the backend's model_options.

Args:
model_options: the model_options for this call

Returns:
a new dict

-----

##### `_make_backend_specific_and_remove(self, model_options, is_chat_context)`

Maps specified Mellea specific keys to their backend specific version and removes any remaining Mellea keys.

Args:
model_options: the model_options for this call

Returns:
a new dict

-----

##### `generate_from_context(self, action, ctx)`

See `generate_from_chat_context`.

-----

##### `generate_from_chat_context(self, action, ctx)`

Generates a new completion from the provided Context using this backend's `Formatter`.

-----

##### `_generate_from_raw(self, actions)`

Generates a completion text. Gives the input provided to the model without templating.

-----

##### `_extract_model_tool_requests(self, tools, chat_response)`

-----

---
